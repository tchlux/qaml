% preamble
\documentclass[12pt]{article}
\usepackage{geometry, amsmath, amssymb, caption, subcaption, enumerate, upgreek, array}
\geometry{
letterpaper,
total={6.5in,9in},
left=1in,
top=1in}
\parindent = 0pt
\parskip = 6pt

% define QED
\newcommand*{\QED}{\hfill\ensuremath{\blacksquare}}

% define numberthis
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

% math-mode version of "l" column type
\newcolumntype{L}{>{$}l<{$}}
% document
\begin{document}
\section*{Proof of correctness an n-bit adder}
\today
\subsection*{Proof}
Suppose that the QUBO cost function $C_{n-1}(x,y,s)$ provides solutions for
$x+y=s$ when $x$ and $y$ are $n-1$-bit integers and $s$ is a $n$-bit
integer.
Denote $x_n, \ldots, x_1$ the bits of $x$ in order from most to least
significant, and similarly for $y$ ($y_n, \ldots, y_1$) and $s$ 
($s_{n+1}, \ldots, s_1$).
Furthermore, suppose that
\begin{enumerate}
\item[(1)] The maximum magnitude weights for these
cost functions have values of $+/- 4^{k-1}$
\item[(2)] The weights satisfy: the weights on/connection between
$x_i$, $y_j$, and $s_k$ are exactly 4 times those on/between
$x_{i-1}$, $y_{j-1}$, and $s_{k-1}$
respectively (for all $i,j,k > 1$).
\end{enumerate}
Then any function $C_n(x,y,s)$ that contains all the terms from
$C_{n-1}$ will necessarilly provide correct energies for solving $x+y=s$,
whenever $x_n = 0$ and $y_n = 0$.
Similarly, consider any scaling of the $n$-bit adder weights applied
to the $n-1$ MSB of $x_n$ and $y_n$. 
Specifically, choose these weight so that they are 4 times those of the
standard $n-1$-bit adder.
Then whenever $x_1=0$ and $y_1=0$, the function $C_n(x,y,s)$ with these
weights will satisfy all the constraints to guarantee $x+y=s$.
Furthermore, by (2), these weights do not conflict with the previously
assigned weights, and by construction, property (2) is maintained.
Also, this establishes a lower bound for (1) since weights of
$+/- 4^n$ will be assigned.
So far, we have specified all the connections except those between the
most and least significant bits of $x$, $y$, and $s$.
So, it remains to show that:
\begin{itemize}
\item The 4 connections between $x_n \& x_1$, $x_n \& y_1$, $y_n \& x_1$,
and $y_n \& y_1$ are all equal to $2^n$.
\item The 2 connections between $s_{n+1} \& x_1$ and $s_{n+1} \& y_1$ are
equal to $-2^{n+1}$.
\item The 2 connections between $s_1 \& x_n$ and $s_1 \& y_n$ are equal to
$-2^n$.
\item The connection between $s_1 \& s_{n+1}$ is $2^{n+1}$.
\end{itemize}
There are $3\times 3 \times (2^{(2n-2)}) \times 2^{n+1}$ inequality
constraints that have not yet been addressed.
(3 ways the 2 MSBs could be nonzero, 3 ways the 2 LSBs could be nonzero,
$(2^{(2n-4)})$ combinations of the 2 sets of $n-2$ bits that are neither
the MSB or LSB of $x$ or $y$, and $2^{n+1}$ ways to choose $s$).
I.e., the cost function that correctly implements an adder in a fully-connected
graph is:
\begin{align*}    
C_n(x,y,z) = \sum_{i=1}^n{4^{i-1}(x_i+y_i)}
+ \sum_{i=1}^{n+1}{4^{i-1}s_i} 
+ \sum_{i=1}^{n-1}\sum_{j=i+1}^{n}2^{i+j-1}(x_ix_j+y_iy_j) 
+ \sum_{i=1}^{n}\sum_{j=i+1}^{n+1}2^{i+j-1}s_is_j\\
+ \sum_{i=1}^n\sum_{j=1}^n2^{i+j-1}x_iy_j 
- \sum_{i=1}^{n+1}\sum_{i=1}^n2^{i+j-1}s_i(x_j+y_j)
\end{align*}
\subsection*{Alternate Proof}
\begin{tabular}{LLLL}
   &c_n &c_{n-1} ... &c_1 \\
+  &x_n &x_{n-1} ... &x_1 \\
+  &y_n &y_{n-1} ... &y_1 \\
\hline
c_{n+1}   &s_n &s_{n-1} ... &s_1 \\
\hline
\end{tabular}\\ 
Let $s_{n+1}=c_{n+1}$.
$c_1$ is the carry-in and the rest of $c_i$ are carry bits encountered while adding $c_1, x, y$.\\
Lemma 1: The equation for the complete addition shown above is 
\begin{equation}
c_1 + \sum_{i=1}^{n}2^{i-1}(x_i + y_i) = \sum_{i=1}^{n}2^{i-1}s_i + 2^nc_{n+1} \label{eq1}
\end{equation}
Proof: Assume \ref{eq1} is true for $n=k$, i.e;
\begin{equation}
c_1 + \sum_{i=1}^{k}2^{i-1}(x_i+y_i) = \sum_{i=1}^{k}2^{i-1}s_i + 2^kc_{k+1} \label{eq2}
\end{equation}
For $n=k+1$, from equation for full-adder, we have
\begin{equation}
c_{k+1} + x_{k+1} + y_{k+1} = s_{k+1}+2c_{k+2} \label{eq3}    
\end{equation}
Using the value of $c_{k+1}$ from \ref{eq2} in \ref{eq3}, we get
\begin{align*}
\frac{c_1 + \sum_{i=1}^{k}2^{i-1}(x_i+y_i) - \sum_{i=1}^{k}2^{i-1}s_i}{2^k} + x_{k+1} + y_{k+1} &= s_{k+1}+2c_{k+2}\\
\iff c_1 + \sum_{i=1}^{k}2^{i-1}(x_i+y_i) - \sum_{i=1}^{k}2^{i-1}s_i + 2^kx_{k+1} + 2^ky_{k+1} &= 2^ks_{k+1} + 2^{k+1}c_{k+2}\\
\iff c_1 + \sum_{i=1}^{k+1}2^{i-1}(x_i+y_i) &= \sum_{i=1}^{k+1}2^{i-1}s_i + 2^{k+1}c_{k+2}
\end{align*}
i.e; \ref{eq1} is true for $n=k+1$. \QED \\
We can now use \ref{eq1} to derive a QUBO for n-bit addition with a carry-in and carry-out.
\begin{align*}
\bigg(c_1 + \sum_{i=1}^{n}2^{i-1}(x_i + y_i) - \sum_{i=1}^{n+1}2^{i-1}s_i\bigg)^2 &= 0\\
c_1 + \sum_{i=1}^{n}4^{i-1}(x_i+y_i) 
+ \sum_{i=1}^{n+1}4^{i-1}s_i
+ \sum_{i=1}^{n-1}\sum_{j=i+1}^{n}2^{i+j-1}(x_ix_j+y_iy_j) 
+ \sum_{i=1}^n\sum_{j=1}^n2^{i+j-1}x_iy_j \\
+ \sum_{i=1}^n\sum_{j=i+1}^{n+1}2^{i+j-1}s_is_j
+ \sum_{i=1}^n2^ic_1(x_i+y_i)
- \sum_{i=1}^{n+1}2^ic_1s_i
- \sum_{i=1}^{n+1}\sum_{i=1}^n2^{i+j-1}s_i(x_j+y_j)
&= 0
\end{align*}
Setting $c_1=0$ gives QUBO for n-bit addition with no carry-in but a carry-out.
\section*{Proof of correctness of m-int n-bit signed adder}
The complete addition is shown below.\\
\begin{tabular}{LLLLLLL}
   & & &x_{1n} &... &x_{12} &x_{11} \\
   & & &x_{2n} &... &x_{22} &x_{21} \\
   & & &.\\& & &.\\& & &.\\
+  & & &x_{mn} &... &x_{m2} &x_{m1} \\
\hline
s_{n+m-1} &... &s_{n+1}   &s_n &... &s_2 &s_1 \\
\hline
\end{tabular}\\ \\
Consider adding one number after another to the intermediate sum.\\The first step is:\\
\begin{tabular}{LLLLL}
   &x_{1n} &... &x_{12} &x_{11} \\
+  &x_{2n} &... &x_{22} &x_{21} \\
\hline
s_{2(n+1)}   &s_{2n} &... &s_{22} &s_{21} \\
\hline
\end{tabular}\\ \\
Using Lemma 1, we can write
\begin{align*}
    \sum_{i=1}^{n}2^{i-1}(x_{1i}+x_{2i}) = \sum_{i=1}^{n+1}2^{i-1}s_{2i} \label{p2_s1} \numberthis
\end{align*}
The second step is:\\
\begin{tabular}{LLLLLL}
   &s_{2(n+1)} &s_{2n} &... &s_{22} &s_{21} \\
+  &x_{3n} &x_{3n} &... &x_{32} &x_{31} \quad\text{(sign extension)}\\
\hline
s_{3(n+2)} &s_{3(n+1)}  &s_{3n} &... &s_{32} &s_{31} \\
\hline
\end{tabular}\\ \\
Using Lemma 1, we can write
\begin{align*}
    \sum_{i=1}^{n+1}2^{i-1}s_{2i}+\sum_{i=1}^{n}2^{i-1}x_{3i}+2^nx_{3n} &= \sum_{i=1}^{n+2}2^{i-1}s_{3i}\\
    \implies \sum_{i=1}^{n}2^{i-1}(x_{1i}+x_{2i}+x_{3i})+2^nx_{3n} &= \sum_{i=1}^{n+2}2^{i-1}s_{3i}  \numberthis \label{p2_s2}\\
    \tag{Using \ref{p2_s1}}
\end{align*}
The third step is:\\
\begin{tabular}{LLLLLLL}
   &s_{3(n+2)} &s_{3(n+1)} &s_{3n} &... &s_{32} &s_{31} \\
+  &x_{4n} &x_{4n} &x_{4n} &... &x_{42} &x_{41} \quad\text{(sign extension)}\\
\hline
s_{4(n+3)} &s_{4(n+2)} &s_{4(n+1)}  &s_{4n} &... &s_{42} &s_{41} \\
\hline
\end{tabular}\\ \\
Using Lemma 1, we can write
\begin{align*}
    \sum_{i=1}^{n+2}2^{i-1}s_{3i}+\sum_{i=1}^{n}2^{i-1}x_{4i}+\sum_{i=n+1}^{n+2}2^{i-1}x_{4n} &= \sum_{i=1}^{n+3}2^{i-1}s_{4i}\\
    \implies \sum_{i=1}^{n}2^{i-1}(x_{1i}+x_{2i}+x_{3i}+x_{4i})+\sum_{i=n+1}^{n+1}2^{i-1}x_{3n} + \sum_{i=n+1}^{n+2}2^{i-1}x_{4n} &= \sum_{i=1}^{n+3}2^{i-1}s_{4i}  \numberthis\\
    \tag{Using \ref{p2_s2}}
\end{align*}
We can now see a pattern and guess the equation for the m-int n-bit addition to be
\begin{align*}
    \sum_{i=1}^{n}2^{i-1}\sum_{j=1}^{m}x_{ji} + \sum_{j=3}^{m}x_{jn}\sum_{i=n+1}^{n+j-2}2^{i-1}
    = \sum_{i=1}^{n+m-1}2^{i-1}s_{mi} \numberthis{} \label{p2_s3}
\end{align*}
We can prove this by induction on $m$.\\
Let (\ref{p2_s3}) be true for $m=k-1$. Then,\\
\begin{align*}
    \sum_{i=1}^{n}2^{i-1}\sum_{j=1}^{k-1}x_{ji} + \sum_{j=3}^{k-1}x_{jn}\sum_{i=n+1}^{n+j-2}2^{i-1}
    &= \sum_{i=1}^{n+k-2}2^{i-1}s_{(k-1)i} \numberthis \label{p2_s4}
\end{align*}
For $m=k+1$, we have\\
\begin{tabular}{LLLLLLLLL}
   &s_{(k-1)(n+k-2)} &... &s_{(k-1)(n+1)} &s_{(k-1)n} &... &s_{(k-1)2} &s_{(k-1)1} \\
+  &x_{kn} &... &x_{kn} &x_{kn} &... &x_{k2} &x_{k1} \quad\text{(sign extension)}\\
\hline
s_{k(n+k-1)} &s_{k(n+k-2)} &... &s_{k(n+1)}  &s_{kn} &... &s_{k2} &s_{k1} \\
\hline
\end{tabular}\\ \\
Using Lemma 1, we can write
\begin{align*}
    \sum_{i=1}^{n+k-2}2^{i-1}s_{(k-1)i} + \sum_{i=1}^n2^{k-1}x_{ki} + \sum_{i=n+1}^{n+k-2}2^{i-1}x_{kn} &= \sum_{i=1}^{n+k-1}s_{ki}\\
    \implies \sum_{i=1}^{n}2^{i-1}\sum_{j=1}^{k-1}x_{ji} + \sum_{j=3}^{k-1}x_{jn}\sum_{i=n+1}^{n+j-2}2^{i-1} + \sum_{i=1}^n2^{k-1}x_{ki} + \sum_{i=n+1}^{n+k-2}2^{i-1}x_{kn} &= \sum_{i=1}^{n+k-1}s_{ki} \tag{Using \ref{p2_s4}}\\
    \implies \sum_{i=1}^{n}2^{i-1}\sum_{j=1}^{k}x_{ji} + \sum_{j=3}^{k}x_{jn}\sum_{i=n+1}^{n+j-2}2^{i-1} &= \sum_{i=1}^{n+k-1}s_{ki} 
\end{align*}
This shows (\ref{p2_s3}) is true for $m=k+1$ and proves (\ref{p2_s4}) is true $\forall m\geq2.$\\
(\ref{p2_s3}) can be simplified as 
\begin{align*}
    \sum_{i=1}^{n}2^{i-1}\sum_{j=1}^{m}x_{ji} + \sum_{j=3}^{m}2^n(2^{j-2}-1)x_{jn}
    = \sum_{i=1}^{n+m-1}2^{i-1}s_{mi} \numberthis{} \label{p2_s5}
\end{align*}
We can now use (\ref{p2_s5}) to obtain the following QUBO for m-int n-bit signed addition:
\begin{align*}
    \bigg(\sum_{i=1}^{n}2^{i-1}\sum_{j=1}^{k-1}x_{ji} + \sum_{j=3}^{k-1}2^n(2^{j-2}-1)x_{jn}
    - \sum_{i=1}^{n+k-2}2^{i-1}s_{(k-1)i}\bigg)^2 &= 0
\end{align*}

Much simpler for unsigned int:\\
(\ref{p2_s5}) is just writing down $x_1+x_2+...+x_n=s$ with $x_j=\sum_{i=1}^{n}2^{i-1}x_{ji}$

If $x=\sum_{i=0}^{n-1}2^{i}x_i,\quad y=\sum_{i=0}^{n-1}2^{i}y_i,\quad s=\sum_{i=0}^{n}2^{i}s_i$, then
$$x+y=s \implies \sum_{i=0}^{n-1}2^{i}x_i+\sum_{i=0}^{n-1}2^{i}y_i = \sum_{i=0}^{n}2^{i}s_i$$
Getting this equation onto one side and squaring gives the QUBO.

\section*{Unsigned multiplication}
Let $x=\sum_{i=0}^{n-1}2^{i}x_i,\; y=\sum_{i=0}^{n-1}2^{i}y_i,\; p=\sum_{i=0}^{2n-1}2^{i}p_i$.
\begin{align*}
    xy=p \iff \sum_{i=0}^{n-1}2^{i}x_i\sum_{j=0}^{n-1}2^{j}y_j &= \sum_{i=0}^{2n-1}2^{i}p_i\\
    \bigg(\sum_{i=0}^{n-1}\sum_{j=0}^{n-1}2^{i+j}x_iy_j - \sum_{i=0}^{2n-1}2^ip_i\bigg)^2 &= 0
\end{align*}
\end{document}
